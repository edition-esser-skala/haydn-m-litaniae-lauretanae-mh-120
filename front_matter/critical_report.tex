\documentclass[parskip=full]{scrreprt}

\RedeclareSectionCommand[pagestyle=plain,afterskip=10pt plus 1pt]{chapter}
\setkomafont{chapter}{\mdseries\headingfont\fontsize{40}{40}\selectfont\color{black!80}}
\setkomafont{pageheadfoot}{\normalsize}

\def\pnumbox#1{#1\hspace*{7cm}}
\def\gobble#1{}
\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=0pt,
  entryformat=\itshape,
  entrynumberformat=\textcolor{oldred},
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox,
  pagenumberformat=\itshape
]{tocline}{part}

\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=0pt,
  entrynumberformat=\textcolor{oldred},
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox
]{tocline}{section}

\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=-\parskip,
  entrynumberformat=\gobble,
  entryformat=\ltseries,
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox,
  pagenumberformat=\ltseries
]{tocline}{subsection}


\usepackage{polyglossia}
\setdefaultlanguage{english}


\usepackage{fontspec}
\setmainfont{Source Sans Pro}[
  ItalicFont = Source Sans Pro Italic,
  BoldFont = Source Sans Pro Bold,
  BoldItalicFont = Source Sans Pro Bold Italic,
  FontFace = {lt}{n}{Source Sans Pro Light},
  FontFace = {lt}{it}{Source Sans Pro Light Italic},
  FontFace = {sb}{n}{Source Sans Pro Semibold},
  FontFace = {sb}{it}{Source Sans Pro Semibold Italic},
  Numbers = Proportional,
  Ligatures = Common
]
\DeclareRobustCommand{\ltseries}{\fontseries{lt}\selectfont}
\DeclareRobustCommand{\sbseries}{\fontseries{sb}\selectfont}
\DeclareTextFontCommand{\textlt}{\ltseries}
\DeclareTextFontCommand{\textsb}{\sbseries}
\newfontfamily\headingfont{Fredericka the Great}


\usepackage[pass]{geometry}
\newgeometry{twoside,inner=20mm,outer=40mm,top=20mm,bottom=40mm}


\usepackage{url}
\urlstyle{same}


\usepackage{microtype}
\microtypesetup{verbose=silent}


\usepackage{booktabs,array,longtable}
\newcolumntype{L}[1]{%
  >{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}%
}


\usepackage{graphicx}


\usepackage{xcolor}
\definecolor{oldred}{rgb}{.8313,0,0}


\usepackage{pdfpages}


\usepackage{scrlayer-scrpage}
\pagestyle{scrheadings}
\clearscrheadfoot
\cfoot[\thepage]{\thepage}
\pagenumbering{roman}

\usepackage{enumitem}
\setlist[description]{%
  style=nextline,%
  leftmargin=2em,%
  first=\ltseries,%
  font=\normalfont%
}
\def\lyrefitem#1{\item[\lyref{#1}]}


\makeatletter

\def\@firstofthree#1#2#3{#1}
\def\@secondofthree#1#2#3{#2}
\def\@thirdofthree#1#2#3{#3}
\def\@firstoffour#1#2#3#4{#1}
\def\@secondoffour#1#2#3#4{#2}
\def\@thirdoffour#1#2#3#4{#3}
\def\@fourthoffour#1#2#3#4{#4}
\def\Dotfill{\leavevmode\cleaders\hb@xt@ .75em{\hss .\hss }\hfill \kern \z@}

\def\lyrefnumber#1{\expandafter\@setref\csname r@#1\endcsname\@firstofthree{#1}}
\def\lyreftitle#1{\expandafter\@setref\csname r@#1\endcsname\@secondofthree{#1}}
\def\lyrefpage#1{\expandafter\@setref\csname r@#1\endcsname\@thirdofthree{#1}}

\def\lyrefgenrenumber#1{\expandafter\@setref\csname r@#1\endcsname\@firstoffour{#1}}
\def\lyrefgenregenre#1{\expandafter\@setref\csname r@#1\endcsname\@secondoffour{#1}}
\def\lyrefgenretitle#1{\expandafter\@setref\csname r@#1\endcsname\@thirdoffour{#1}}
\def\lyrefgenrepage#1{\expandafter\@setref\csname r@#1\endcsname\@fourthoffour{#1}}

\def\lyref#1{%
  \begingroup%
  \makebox[0pt][l]{\color{oldred}\lyrefnumber{#1}}\hspace*{2em}%
  \lyreftitle{#1}\Dotfill\lyrefpage{#1}%
  \endgroup%
}
\def\lyrefpart#1{%
  \begingroup%
  \makebox[0pt][l]{\sbseries\color{oldred}\lyrefnumber{#1}}\hspace*{2em}%
  \makebox[0pt][l]{\sbseries\lyreftitle{#1}}\hspace*{6.5em}%
  \hfill\sbseries\lyrefpage{#1}%
  \endgroup%
}
\def\lyrefsection#1{%
  \begingroup%
  \makebox[0pt][l]{\color{oldred}\lyrefgenrenumber{#1}}\hspace*{2em}%
  \makebox[0pt][l]{\ltseries\lyrefgenregenre{#1}}\hspace*{6.5em}%
  \lyrefgenretitle{#1}\Dotfill\lyrefgenrepage{#1}%
  \endgroup%
}
\InputIfFileExists{../tmp/lilypond.ref}{}{\InputIfFileExists{../lilypond.ref}{}{}}


\newcommand\fancytitlehead{
  \headingfont%
  \fontsize{80}{80}\selectfont%
  \textcolor{black!80}{%
    \makebox[0pt][l]{\@ifundefined{@shortname}{\@lastname}{\@shortname}.}%
  }\\[15pt]%
  \fontsize{60}{60}\selectfont%
  \makebox[0pt][l]{\@ifundefined{@shorttitle}{\@title}{\@shorttitle}.}%
}


\def\firstname#1{\def\@firstname{#1}}
\def\lastname#1{\def\@lastname{#1}}
\def\shortname#1{\def\@shortname{#1}}
\def\shorttitle#1{\def\@shorttitle{#1}}
\def\namesuffix#1{\def\@namesuffix{#1}}
\def\scoring#1{\def\@scoring{#1}}
\def\parts#1{\def\@parts{#1}}

\firstname{\relax}
\lastname{\relax}
\namesuffix{\relax}
\scoring{\relax}
\parts{\relax}


\def\maketitle{%
\begin{titlepage}%
  \Large%
  {\@titlehead}%
  \vfill%
  {\strut\@firstname}\\%
  {\sbseries\color{oldred}\strut\@lastname}\\%
  {\strut\@namesuffix}%
  \vfill%
  {\sbseries\@title}\\%
  {\@subtitle}\\[\baselineskip]%
  {\itshape\@scoring}%
  \vfill%
  {\itshape\@parts}\hspace*{\fill}\raisebox{0pt}[0pt][0pt]{\includegraphics{ees_logo}}%
\end{titlepage}%
}


\newif\iftemplate\templatetrue
\newif\ifprintreport\printreportfalse
\directlua{
scores = {
  ob1 = "Oboe I",
  ob2 = "Oboe II",
  ottoni = "Clarino I, II in C\string\\newline Timpani in C–G",
  vl1 = "Violino I",
  vl2 = "Violino II",
  coro = "Coro",
  org = "Organo",
  b = "Bassi",
  full_score = "Full Score"
}

last_arg = arg[\string#arg]
texio.write("Last argument: " .. last_arg)
if not (scores[last_arg] == nil) then
  tex.print("\string\\def\string\\lypdfname{" .. last_arg .. "}")
  tex.print("\string\\parts{" .. scores[last_arg] .. "}")
  if (last_arg == "full_score") then
    tex.print("\string\\printreporttrue")
  end
end
}

\@ifundefined{lypdfname}{%
  \templatefalse
  \printreporttrue
  \parts{Draft}
}{\templatetrue}

\makeatother



\begin{document}
\frenchspacing

\titlehead{\fancytitlehead}
\firstname{Johann Michael}
\lastname{Haydn}
\namesuffix{(doubtful attribution)}
\shortname{M. Haydn}
\title{Litaniae lauretanae}
\shorttitle{Lit. lauretanae}
\subtitle{MH 120\\(D-NATk NA/SP (H-53))}
\scoring{S, A, T, B (solo), S, A, T, B (coro), 2 ob, 2 clno (C), timp (C–G), 2 vl, b, org}
\maketitle


\thispagestyle{empty}

\vspace*{\fill}

\raisebox{-4mm}{\includegraphics{byncsaeu}}\hspace*{1em}Wolfgang Esser-Skala, 2021

© 2021 by Wolfgang Esser-Skala. This edition is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. To view a copy of this license, visit \url{http://creativecommons.org/licenses/by-nc-sa/4.0/}.

Music engraving by LilyPond 2.22.0 (\url{http://www.lilypond.org}).\\
Front matter typeset with Source Sans Pro and Fredericka the Great.

\textit{First version, September 2021}

\vspace*{2cm}

\ifprintreport
\chapter*{Critical Report}

This edition bases upon a copy in the Benediktinerabtei Niederaltaich. The digital version of the manuscript is available at \url{https://mirador.acdh.oeaw.ac.at/musikarchivspitz/D-NATk_H53/} (siglum NA/SP H-53; see also RISM ID 455039974).

In general, this edition closely follows the manuscript. Any changes that were introduced by the editor are indicated by italic type (lyrics, dynamics and directions), parentheses (expressive marks and bass figures) or dashes (slurs and ties). Accidentals are used according to modern conventions. Asterisks denote changes that are clarified in the detailed remarks below.\footnote{Abbreviations: A, alto; B, bass; b, basses; clno, clarion; Ms, manuscript; ob, oboe; org, organ; r, rest; S, soprano; T,~tenor; timp, timpani; vl, violin; vlne, violone.}

\bigskip

\begin{longtable}{lll L{10cm}}
  \toprule
  \itshape Mov. & \itshape Bar & \itshape Staff & \itshape Note \\
  \midrule \endhead
  1 & 1  & clno 1  & 4th eighth in Ms: f″8 \\
    & 1  & vl 2    & 10th sixteenth in Ms: g′16 \\
    & 4  & timp    & last eighth in Ms: G8 \\
    & 4  & vl 2    & 8th sixteenth in Ms: d″16 \\
    & 6  & clno 1  & 1st eighth in Ms: g″8 \\
    & 6  & clno 2  & 1st eighth in Ms: g′8 \\
    & 6  & vl 2    & 4th sixteenth in Ms: g16 \\
    & 6  & org     & 1st eighth in Ms: d8 \\
    & 7  & A       & 2nd half of bar in Ms: c′8–c′8–c′4 \\
    & 8  & vl 2, A & 1st quarter in Ms: c′8.–c′16 \\
    & 9  & clno 1  & 2nd/3rd quarter in Ms: f″8–e″8–e″4 \\
    & 9  & clno 2  & 3rd eight in Ms: d″8 \\
    & 11 & org     & last eighth in Ms: g8 \\
    & 15 & clno 2  & last eighth in Ms: c″8 \\
    & 16 & vl 2    & 10th sixteenth in Ms: g′16 \\
    & 19 & clno 1  & 1st half of bar in Ms: e″4–d″4 \\
    & 19 & clno 2  & 1st half of bar in Ms: c″4–g′4 \\
    & 19 & timp    & 1st half of bar in Ms: c4–G4 \\
    & 22 & S       & 4th quarter in Ms: g′4 \\
    & 23 & ob 1    & 1st half of bar in Ms: a″4–g″4 \\
    & 23 & ob 2    & 1st half of bar in Ms: fis″4–e″4 \\
    & 27 & clno 1  & 2nd quarter in Ms: e″8–d″8 \\
    & 29 & org     & last eighth in Ms: G8 \\
    & 30 & clno 1  & 1st quarter in Ms: e″4 \\
    & 31 & clno 2  & 2nd quarter in Ms: g′8–g′8 \\
  \midrule
  2 & –  & vlne    & rhythm in bars 15, 24, 41, 57, and 58: x4–r8–x8–x8–x8 \\
    & 11 & vl 1    & 2nd quarter in Ms: a′4 \\
    & 25 & vl 1    & 3rd eighth in Ms: g′8 \\
    & 41 & vl 1    & 1st eighth in Ms: g8 \\
    & 61 & vl 2    & bar in Ms: e′4–r4–e″8–d″8 \\
    & 68 & timp    & 1st note in Ms: c2 \\
    & 76 & timp    & 2nd quarter in Ms: c4 \\
    & 77 & clno 1  & 2nd/3rd quarter in Ms: e″4–d″4 \\
    & 77 & clno 2  & 2nd/3rd quarter in Ms: e′4–g′4 \\
    & 77 & timp    & 2nd quarter in Ms: c4 \\
  \midrule
  3 & 19 & org     & 4th eighth in Ms: g8 \\
    & 20 & org     & 4th eighth in Ms: g8 \\
    & 27 & ob 2    & 2nd/3rd quarter in Ms: bes′4 \\
    & 28 & ob 2    & bar in Ms: a′4–g′4–f′2 \\
    & 29 & vl 2    & 3rd quarter in Ms: e′8.–e′16 \\
    & 29 & A       & 5th eighth in Ms: e′8 \\
    & 30 & A       & 2nd half of bar in Ms: f′4–e′4 \\
    & 33 & vl 2    & 3rd eighth in Ms: c′8 \\
    & 35 & vl 1    & 2nd half of bar in Ms: f″4–e″8–d″8 \\
    & 37 & ob 1    & 1st half of bar in Ms: d′′′8–c′′′4–b″8 \\
    & 37 & ob 2    & 1st quarter in Ms: f″8–e″8 \\
    & 37 & clno 1  & 3rd eighth in Ms: d″8 \\
    & 37 & clno 2  & 3rd eighth in Ms: g′8 \\
    & 37 & A       & 2nd half of bar in Ms: g′2 \\
  \midrule
  4 & 2  & A       & bar in Ms unison with T \\
    & 7  & B       & 2nd half of bar in Ms: g4.–f16–es16 \\
    & 8  & vl 2    & 3rd eighth in Ms: a′8 \\
    & 10 & A       & 3rd quarter in Ms: f′8–f′8 \\
    & 16 & vl 1    & 2nd eighth in Ms: es″16.–es′32 \\
    & 12 & A       & bar in Ms unison with T \\
    & 17 & T       & 4th quarter in Ms: des′4 \\
    & 33 & B       & 1st quarter in Ms: c4 \\
    & 33 & org     & last eighth in Ms: g8 \\
    & 42 & clno 1  & 3rd quarter in Ms: e″8 \\
    & 43 & A       & 1st quarter in Ms: e′8–r8 \\
    & 51 & clno 1  & 3rd quarter in Ms: e″8 \\
    & 51 & clno 2  & bar in Ms: g′8–g′8–c″8–c″8 \\
    & 58 & A       & 4th eighth in Ms: f′8 \\
    & 58 & B       & 4th eighth in Ms: d8 \\
    & 60 & ob 1    & 1st quarter in Ms: a′8–r8 \\
    & 65 & vl 2    & 2nd quarter in Ms: f′4 \\
    & 77 & clno 1  & 3rd quarter in Ms: e″8 \\
  \midrule
  5 & 5  & vl 1    & last eighth in Ms: g″16–g″16 \\
    & 6  & ob 1    & 2nd half of bar in Ms: des″2 \\
    & 6  & ob 2    & 2nd half of bar in Ms: bes′2 \\
    & 12 & ob 1    & 2nd half of bar in Ms: es″2 \\
    & 12 & ob 2    & 2nd half of bar in Ms: c″2 \\
    & 15 & vl 2    & 15th sixteenth in Ms: a′16 \\
    & 16–18 & S    & 2nd half of bar 16 to end of bar 18 in Ms: unison with T \\
  \bottomrule
\end{longtable}


This edition has been compiled and checked with utmost diligence. Nevertheless, errors and mistakes cannot be totally excluded. Please report any errors and mistakes to \url{wolfgang@esser-skala.at} or create an issue or pull request on the edition’s GitHub page \url{https://github.com/skafdasschaf/haydn-m-litaniae-lauretanae-MH-120}. Your help will be greatly appreciated.

\bigskip
\textit{Koppl, September 2021\\
Wolfgang Esser-Skala}

\cleardoublepage
\chapter*{Contents}

\InputIfFileExists{../tmp/lilypond.toc}{}{\InputIfFileExists{../lilypond.toc}{}{}}

\cleardoublepage
\fi

\iftemplate
\includepdf[pages=-]{../tmp/\lypdfname.pdf}
\fi

\end{document}
